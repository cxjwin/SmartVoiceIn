# SmartVoiceIn 技术博客总结

## 1. 项目定位

`SmartVoiceIn` 是一个 macOS 菜单栏语音输入工具，也是一个 **Vibe Coding 的实践验证项目**。

核心功能：按快捷键录音，语音转文字后自动粘贴到当前输入框。

核心目标：
- **本地优先，低延迟**：解决云端 API 的网络延时问题。
- **高度可定制**：解决现有工具快捷键冲突（特别是 HHKB FN 键）和无法自定义的问题。
- **云端可扩展**：支持接入最新模型（MiniMax, Qwen, GLM 等）提升效果。
- **可用性兜底**：本地/云端失败自动降级，保证输入不中断。

## 2. 开发动机

本来是为了更顺畅地进行 Vibe Coding，尝试了 Typeless、闪电说、微信语音输入等工具，但发现存在以下痛点：
- **快捷键冲突**：占用 FN 键，对 HHKB 用户（无独立 F 区）极不友好，且无法识别 HHKB 的 FN 组合。
- **定制性差**：无法灵活配置左右修饰键（Left/Right Option/Command）。
- **成本与隐私**：部分工具收费昂贵，且必须依赖云端。
- **识别准确度**：现有工具在特定场景下识别率不稳定。

因此诞生了 "Smart Voice Input" 的想法：利用 Vibe Coding 的高效率，自己按需求定制一个语音输入法。甚至本文档也是通过该工具纯语音输入完成，以“Dogfooding”方式验证其准确性和稳定性。

## 3. Vibe Coding 实践体验

整个开发过程完全采用 Vibe Coding（通过自然语言描述驱动编程）方式：

- **开发模式**：
  - **口语即代码**：将想法通过口语表述出来，让 AI 工具生成代码。
  - **角色转变**：开发者主要扮演 **产品经理**（提需求）和 **测试工程师**（验证 Bug）的角色。
  - **极速构建**：App 的基础功能仅用 **两个晚上** 就搭建完成。
  - **后期打磨**：后续花费大量时间进行细节打磨、Prompt 调优和架构重构。

- **架构师介入**：
  - 虽然 AI 能快速生成代码，但在功能扩展时（如支持多 Provider），初期架构显得捉襟见肘。
  - 需要人为介入进行架构设计（如引入 Provider 模式），指导 AI 进行重构。

- **多模型协作**：
  - 开发过程中尝试混合使用了多种大模型（MiniMax 2.5, GLM 5, Qwen 3.5 Plus）辅助编码。
  - 直接将 API 文档链接丢给 Codex 类工具，自动生成接入代码。

## 4. 技术架构与演进

### 4.1 核心思考：从云端到全链路本地化
- **ASR 阶段**：起初使用腾讯云 ASR，但受网络延时影响体验。调研发现 **Qwen-ASR (0.6B/1.7B)** 开源模型效果不错，1.7B 精度更高但体积更大。
- **LLM 阶段**：既然 ASR 可以本地化，LLM 推理是否也可以？
  - 尝试引入体积较小的本地语言模型进行文本润色。
  - 结论：纯本地模型能保证输入输出速度，满足基本诉求，但对电脑配置（存储/显存）有一定要求。

### 4.2 Provider 抽象层
ASR 和 LLM 都通过统一接口接入，支持运行时动态切换：

#### ASR（语音识别）
- **本地模型**：Qwen3 ASR（0.6B/1.7B），Apple Speech（系统自带）。
- **云端服务**：腾讯云 ASR。
- **策略**：模型加载/下载期间自动回退 Apple Speech，避免用户等待。

#### LLM 文本优化
- **本地模型**：MLX 本地推理。
- **云端服务**：MiniMax, 腾讯混元。
- **策略**：优化失败直接回退原文。

### 4.3 Prompt 工程
- 对提示词进行了大量版本的迭代调优。
- 目前在绝大多数（约 80%）场景下能获得满意的标点与格式修正效果。

### 4.4 交互与细节优化
- **快捷键**：深度定制，支持左右修饰键区分，完美适配 HHKB 等键盘。
- **输入兼容性**：处理输入法冲突，配置弹窗支持 `Cmd+C/V` 等标准快捷键。
- **体验**：状态栏不遮挡视线，日志降噪。

## 5. 关键技术点总结

1.  **Provider 模式**：统一接口封装本地/云端能力，易于扩展。
2.  **可用性优先**：多级回退策略（Local LLM -> Cloud LLM -> Raw Text; Local ASR -> System ASR）。
3.  **配置持久化**：UI 配置优先于环境变量，支持实时生效。
4.  **桌面端适配**：解决输入法焦点抢占、系统 Beep 声、快捷键冲突等原生开发痛点。

## 6. 后续规划

1.  **模型管理面板**：更直观的下载、版本管理与缓存清理。
2.  **场景化路由**：根据不同 App 自动选择不同的 Prompt 或模型（如写代码 vs 聊天）。
3.  **质量评测**：建立自动化测试集，持续量化 Prompt 和模型的优化效果。

---

**项目地址**：https://github.com/cxjwin/SmartVoiceIn
